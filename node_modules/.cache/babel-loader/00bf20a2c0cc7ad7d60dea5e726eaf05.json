{"ast":null,"code":"import { computed, defineCustomElement, ref } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { useCommonCartEffect } from './commonCartEffect.js'; // 购物车操作相关\n\nconst useCartEffect = shopId => {\n  const {\n    changeCartItemInfo\n  } = useCommonCartEffect();\n  const store = useStore();\n  const cartList = store.state.cartList; // 购物车\n  // 计算购物车物品数量\n\n  const cartTotal = computed(() => {\n    const productList = cartList[shopId]?.productList;\n    let count = 0;\n\n    if (productList) {\n      for (const i in productList) {\n        const produnct = productList[i];\n        count += produnct.count;\n      }\n    }\n\n    return count;\n  }); // 计算购物车物品价格\n\n  const cartPrice = computed(() => {\n    const productList = cartList[shopId]?.productList;\n    let price = 0;\n\n    if (productList) {\n      for (const i in productList) {\n        const product = productList[i];\n\n        if (product.check) {\n          price += product.count * product.price;\n        }\n      }\n    }\n\n    return price.toFixed(2);\n  }); // 获取cartList\n\n  const productList = computed(() => {\n    const productList = cartList[shopId]?.productList;\n    return productList;\n  }); // 根据购物车物品是否选中来判断全选状态\n\n  const allChecked = computed(() => {\n    const productList = cartList[shopId]?.productList;\n    let checked = true;\n\n    if (productList) {\n      for (const i in productList) {\n        const product = productList[i];\n\n        if (product.count > 0 && !product.check) {\n          checked = false;\n        }\n      }\n    }\n\n    return checked;\n  }); // 获取购物车内物品是否被选中\n\n  const changeCartItemChecked = (shopId, productId) => {\n    store.commit('changeCartItemChecked', {\n      shopId,\n      productId\n    });\n  }; // 全选按钮实现\n\n\n  const setCartItemSelect = shopId => {\n    store.commit('setCartItemSelect', {\n      shopId\n    });\n  }; // 清空购物车\n\n\n  const cleanCartProducts = shopId => {\n    store.commit('cleanCartProducts', {\n      shopId\n    });\n  };\n\n  return {\n    changeCartItemChecked,\n    changeCartItemInfo,\n    cartTotal,\n    cartPrice,\n    productList,\n    cleanCartProducts,\n    allChecked,\n    setCartItemSelect\n  };\n}; // 展示隐藏购物车逻辑\n\n\nconst toggleCartEffect = () => {\n  const showCart = ref(false);\n\n  const handleCartShowChange = () => {\n    showCart.value = !showCart.value;\n  };\n\n  return {\n    showCart,\n    handleCartShowChange\n  };\n};\n\nexport default {\n  name: 'Cart',\n\n  setup() {\n    const route = useRoute();\n    const shopId = route.params.id;\n    const {\n      showCart,\n      handleCartShowChange\n    } = toggleCartEffect();\n    const {\n      changeCartItemInfo,\n      cartTotal,\n      cartPrice,\n      productList,\n      changeCartItemChecked,\n      cleanCartProducts,\n      allChecked,\n      setCartItemSelect\n    } = useCartEffect(shopId);\n    return {\n      cartTotal,\n      cartPrice,\n      productList,\n      shopId,\n      changeCartItemInfo,\n      changeCartItemChecked,\n      cleanCartProducts,\n      allChecked,\n      setCartItemSelect,\n      showCart,\n      handleCartShowChange\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["computed","defineCustomElement","ref","useRoute","useStore","useCommonCartEffect","useCartEffect","shopId","changeCartItemInfo","store","cartList","state","cartTotal","productList","count","i","produnct","cartPrice","price","product","check","toFixed","allChecked","checked","changeCartItemChecked","productId","commit","setCartItemSelect","cleanCartProducts","toggleCartEffect","showCart","handleCartShowChange","value","name","setup","route","params","id"],"sourceRoot":"","sources":["/Users/mac/Desktop/jingdong/src/views/shop/Cart.vue"],"sourcesContent":["<template>\n  <div class=\"mask\" v-if='showCart && cartTotal > 0' @click=\"handleCartShowChange\"></div>\n  <div class=\"cart\">\n    <!-- 购物车选中商品展示 -->\n    <div class=\"product\" v-if='showCart && cartTotal > 0'>\n      <div class=\"product__header\">\n        <div class=\"product__header__all\">\n          <span class=\"product__header__icon iconfont\" v-html=\"allChecked ? '&#xe618;' : '&#xe6f7;'\" @click=\"() => { setCartItemSelect(shopId) }\"></span>\n          全选\n        </div>\n        <div class=\"product__header__clear\">\n          <span class=\"product__header__clear__btn\" @click=\"() => { cleanCartProducts(shopId) }\">清空购物车</span>\n        </div>\n      </div>\n      <template v-for=\"item in productList\" :key=\"item._id\">\n        <div class=\"product__item\"  v-if=\"item.count > 0\">\n          <div class=\"product__item__checked iconfont\" v-html=\"item.check ? '&#xe618;' : '&#xe6f7;' \" @click=\"() => { changeCartItemChecked(shopId, item._id) }\"></div>\n          <img class=\"product__item__img\" :src=\"item.imgUrl\">\n          <div class=\"product__item__detail\">\n            <h4 class=\"product__item__title\">{{item.name}}</h4>\n            <!-- <p class=\"product__item__sales\">月售{{item.sales}}件</p> -->\n            <p class=\"product__item__price\">\n              <span class=\"product__item__yen\">&yen;</span>{{item.price}}\n              <span class=\"product__item__origin\">&yen;{{item.oldPrice}}</span>\n            </p>\n          </div>\n          <div class=\"product__number\">\n            <span class=\"product__number__minus\" @click=\"() => { changeCartItemInfo(shopId, item._id, item, -1) }\">-</span>\n            {{item.count || 0 }}\n            <span class=\"product__number__plus\" @click=\"() => { changeCartItemInfo(shopId, item._id, item, 1) }\">+</span>\n          </div>\n        </div>\n      </template>\n    </div>\n    <!-- 购物车底部显示 -->\n    <div class=\"check\">\n      <div class=\"check__icon\">\n        <img class=\"check__icon__img\" src=\"http://www.dell-lee.com/imgs/vue3/basket.png\" @click=\"handleCartShowChange\">\n        <div class=\"check__icon__tag\">{{cartTotal}}</div>\n      </div>\n      <div class=\"check__info\">\n        总计: <span class=\"check__info__price\">&yen; {{cartPrice}}</span>\n      </div>\n      <div class=\"check__btn\">\n        <router-link :to='{ name: \"Home\" }'>\n          去结算\n        </router-link>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { computed, defineCustomElement, ref } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { useCommonCartEffect } from './commonCartEffect.js'\n\n// 购物车操作相关\nconst useCartEffect = (shopId) => {\n  const { changeCartItemInfo } = useCommonCartEffect()\n  const store = useStore()\n  const cartList = store.state.cartList\n\n  // 购物车\n\n  // 计算购物车物品数量\n  const cartTotal = computed(() => {\n    const productList = cartList[shopId]?.productList\n    let count = 0\n    if (productList) {\n      for (const i in productList) {\n        const produnct = productList[i]\n        count += produnct.count\n      }\n    }\n    return count\n  })\n\n  // 计算购物车物品价格\n  const cartPrice = computed(() => {\n    const productList = cartList[shopId]?.productList\n    let price = 0\n    if (productList) {\n      for (const i in productList) {\n        const product = productList[i]\n        if (product.check) {\n          price += (product.count * product.price)\n        }\n      }\n    }\n    return price.toFixed(2)\n  })\n\n  // 获取cartList\n  const productList = computed(() => {\n    const productList = cartList[shopId]?.productList\n    return productList\n  })\n\n  // 根据购物车物品是否选中来判断全选状态\n  const allChecked = computed(() => {\n    const productList = cartList[shopId]?.productList\n    let checked = true\n    if (productList) {\n      for (const i in productList) {\n        const product = productList[i]\n        if (product.count > 0 && !product.check) {\n          checked = false\n        }\n      }\n    }\n    return checked\n  })\n\n  // 获取购物车内物品是否被选中\n  const changeCartItemChecked = (shopId, productId) => {\n    store.commit('changeCartItemChecked', { shopId, productId })\n  }\n\n  // 全选按钮实现\n  const setCartItemSelect = (shopId) => {\n    store.commit('setCartItemSelect', { shopId })\n  }\n\n  // 清空购物车\n  const cleanCartProducts = (shopId) => {\n    store.commit('cleanCartProducts', { shopId })\n  }\n\n  return { changeCartItemChecked, changeCartItemInfo, cartTotal, cartPrice, productList, cleanCartProducts, allChecked, setCartItemSelect }\n}\n\n// 展示隐藏购物车逻辑\nconst toggleCartEffect = () => {\n  const showCart = ref(false)\n  const handleCartShowChange = () => {\n    showCart.value = !showCart.value\n  }\n  return { showCart, handleCartShowChange }\n}\n\nexport default {\n  name: 'Cart',\n  setup () {\n    const route = useRoute()\n    const shopId = route.params.id\n    const { showCart, handleCartShowChange } = toggleCartEffect()\n    const { changeCartItemInfo, cartTotal, cartPrice, productList, changeCartItemChecked, cleanCartProducts, allChecked, setCartItemSelect } = useCartEffect(shopId)\n    return { cartTotal, cartPrice, productList, shopId, changeCartItemInfo, changeCartItemChecked, cleanCartProducts, allChecked, setCartItemSelect, showCart, handleCartShowChange }\n  }\n}\n</script>\n\n<style lang='scss' scoped>\n@import '../../style/viriables.scss';\n@import '../../style/mixins.scss';\n  // 点击购物车弹出蒙层样式\n  .mask {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0,0,0,0.50);\n  }\n  // 购物车样式\n  .cart {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    // height: .5rem;\n    box-shadow: 0 -1px 1px 0 $content-bgColor;\n    background: $bgColor;\n  }\n  .product {\n    // overflow-y: scroll;\n    overflow-y: scroll;\n    flex: 1;\n    padding: 0 .18rem 0 .16rem;\n    // background: #fff;\n    &__header {\n      display: flex;\n      line-height: .52rem;\n      border-bottom: .01rem solid $content-bgColor;\n      font-size: .14rem;\n      color: $content-fontcolor;\n      &__icon {\n        line-height: .52rem;\n        font-size: .25rem;\n        vertical-align: top;\n        color: $btn-color;\n      }\n      &__clear {\n        flex: 1;\n        text-align: right;\n        &__btn {\n          display: inline-block;\n        }\n      }\n    }\n    &__item {\n      position: relative;\n      display: flex;\n      border-bottom: .01rem solid $content-bgColor;\n      padding: .12rem 0;\n      &__checked {\n        margin-right: .2rem;\n        line-height: .5rem;\n        font-size: .25rem;\n        color: $btn-color;\n      }\n      &__img {\n        margin: 0 .16rem 0 0;\n        width: .68rem;\n        height: .68rem;\n      }\n      &__detail {\n        overflow: hidden;\n      }\n      &__title {\n        margin-bottom: .06rem;\n        font-weight: normal;\n        line-height: .2rem;\n        font-size: .14rem;\n        color: $content-fontcolor;\n        @include ellipsis;\n      }\n      // &__sales {\n      //   margin: .06rem 0;\n      //   line-height: .16rem;\n      //   font-size: .12rem;\n      //   color: $content-fontcolor;\n      // }\n      &__price {\n        line-height: .2rem;\n        font-size: .14rem;\n        color: $highlight-color;\n      }\n      &__yen {\n        font-size: .12rem;\n      }\n      &__origin {\n        margin-left: .06rem;\n        font-size: .12rem;\n        color: $light-fontColor;\n        text-decoration: line-through;\n      }\n      .product__number {\n        position: absolute;\n        right: 0;\n        bottom: .1rem;\n        color: $content-fontcolor;\n        &__minus, &__plus {\n          display: inline-block;\n          width: .2rem;\n          height: .2rem;\n          line-height: .16rem;\n          border-radius: 50%;\n          font-size: .2rem;\n          text-align: center;\n        }\n        &__minus {\n          margin-right: .1rem;\n          border: .01rem solid $medium-fontColor;\n          color: $medium-fontColor;\n        }\n        &__plus {\n          margin-left: .1rem;\n          background: $btn-color;\n          color: $bgColor;\n        }\n      }\n    }\n  }\n\n  // 购物车底部\n  .check {\n    display: flex;\n    height: .5rem;\n    line-height: .5rem;\n    &__icon {\n      position: relative;\n      width: .84rem;\n      line-height: .5rem;\n      &__img {\n        display: block;\n        margin: .12rem auto;\n        width: .28rem;\n        height: .26rem;\n      }\n      &__tag {\n        position: absolute;\n        padding: 0 .01rem;\n        left: .46rem;\n        right: .17rem;\n        top: .03rem;\n        min-width: .2rem;\n        height: .2rem;\n        line-height: .2rem;\n        text-align: center;\n        background: $highlight-color;\n        border-radius: .1rem;\n        transform: scale(.5);\n        transform-origin: left center;\n        color: $bgColor;\n      }\n    }\n    &__info {\n      flex: 1;\n      font-size: .12rem;\n      color: #333;\n      &__price {\n        font-size: .18rem;\n        color: $highlight-color;\n      }\n    }\n    &__btn {\n      width: .98rem;\n      text-align: center;\n      font-size: .14rem;\n      color: $bgColor;\n      background: #4FB0F9;\n      a {\n        color: $bgColor;\n      }\n    }\n  }\n</style>\n"]},"metadata":{},"sourceType":"module"}