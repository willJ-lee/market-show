{"ast":null,"code":"import { ref } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { useCommonCartEffect } from '../../effects/cartEffects.js';\nimport { post } from '../../utils/request.js'; // 订单下单逻辑\n\nconst useMakeOrder = (productList, shopId, shopName) => {\n  const router = useRouter();\n  const store = useStore();\n\n  const handleConfirmOrder = async iscanceled => {\n    const products = [];\n\n    for (let i in productList.value) {\n      const product = productList.value[i];\n      products.push({\n        id: parseInt(product._id, 10),\n        num: product.count\n      }); // console.log(products)\n    }\n\n    try {\n      const result = await post('/api/order', {\n        addressId: 1,\n        shopId,\n        shopName: shopName.value,\n        iscanceled,\n        products\n      });\n\n      if (result?.errno === 0) {\n        router.push({\n          name: 'Home'\n        });\n        store.commit('clearCart', shopId);\n      }\n    } catch (e) {\n      alert('请求失败');\n    }\n  };\n\n  return {\n    handleConfirmOrder\n  };\n}; // 蒙层显示逻辑\n\n\nconst useMaskChange = () => {\n  const showConfirm = ref(false);\n\n  const handleShowConfirm = status => {\n    showConfirm.value = status;\n  };\n\n  return {\n    showConfirm\n  };\n};\n\nexport default {\n  name: 'Order',\n\n  setup() {\n    const route = useRoute();\n    const shopId = parseInt(route.params.id);\n    const {\n      calculations,\n      productList,\n      shopName\n    } = useCommonCartEffect(shopId);\n    const {\n      handleConfirmOrder\n    } = useMakeOrder(productList, shopId, shopName);\n    return {\n      calculations,\n      handleConfirmOrder,\n      showConfirm,\n      handleShowConfirm\n    };\n  }\n\n};","map":{"version":3,"mappings":"AAoBA,SAASA,GAAT,QAAoB,KAApB;AACA,SAASC,QAAT,EAAmBC,SAAnB,QAAoC,YAApC;AACA,SAASC,QAAT,QAAyB,MAAzB;AACA,SAASC,mBAAT,QAAoC,8BAApC;AACA,SAASC,IAAT,QAAqB,wBAArB,C,CAEA;;AACA,MAAMC,YAAW,GAAI,CAACC,WAAD,EAAcC,MAAd,EAAsBC,QAAtB,KAAmC;AACtD,QAAMC,MAAK,GAAIR,SAAS,EAAxB;AACA,QAAMS,KAAI,GAAIR,QAAQ,EAAtB;;AACA,QAAMS,kBAAiB,GAAI,MAAOC,UAAP,IAAsB;AAC/C,UAAMC,QAAO,GAAI,EAAjB;;AACA,SAAK,IAAIC,CAAT,IAAcR,WAAW,CAACS,KAA1B,EAAiC;AAC/B,YAAMC,OAAM,GAAIV,WAAW,CAACS,KAAZ,CAAkBD,CAAlB,CAAhB;AACAD,cAAQ,CAACI,IAAT,CAAc;AAAEC,UAAE,EAAEC,QAAQ,CAACH,OAAO,CAACI,GAAT,EAAc,EAAd,CAAd;AAAiCC,WAAG,EAAEL,OAAO,CAACM;AAA9C,OAAd,EAF+B,CAG/B;AACF;;AACA,QAAI;AACF,YAAMC,MAAK,GAAI,MAAMnB,IAAI,CAAC,YAAD,EAAe;AACtCoB,iBAAS,EAAE,CAD2B;AAEtCjB,cAFsC;AAGtCC,gBAAQ,EAAEA,QAAQ,CAACO,KAHmB;AAItCH,kBAJsC;AAKtCC;AALsC,OAAf,CAAzB;;AAOA,UAAIU,MAAM,EAAEE,KAAR,KAAkB,CAAtB,EAAyB;AACvBhB,cAAM,CAACQ,IAAP,CAAY;AAAES,cAAI,EAAE;AAAR,SAAZ;AACAhB,aAAK,CAACiB,MAAN,CAAa,WAAb,EAA0BpB,MAA1B;AACF;AACF,KAZA,CAYE,OAAOqB,CAAP,EAAU;AACVC,WAAK,CAAC,MAAD,CAAL;AACF;AACF,GAtBA;;AAuBA,SAAO;AAAElB;AAAF,GAAP;AACF,CA3BA,C,CA6BA;;;AACA,MAAMmB,aAAY,GAAI,MAAM;AAC1B,QAAMC,WAAU,GAAIhC,GAAG,CAAC,KAAD,CAAvB;;AACA,QAAMiC,iBAAgB,GAAKC,MAAD,IAAY;AACpCF,eAAW,CAAChB,KAAZ,GAAoBkB,MAApB;AACF,GAFA;;AAGA,SAAO;AAAEF;AAAF,GAAP;AACF,CANA;;AAOA,eAAe;AACbL,MAAI,EAAE,OADO;;AAEbQ,OAAI,GAAK;AACP,UAAMC,KAAI,GAAInC,QAAQ,EAAtB;AACA,UAAMO,MAAK,GAAIY,QAAQ,CAACgB,KAAK,CAACC,MAAN,CAAalB,EAAd,CAAvB;AACA,UAAM;AAAEmB,kBAAF;AAAgB/B,iBAAhB;AAA6BE;AAA7B,QAA0CL,mBAAmB,CAACI,MAAD,CAAnE;AAEA,UAAM;AAAEI;AAAF,QAAyBN,YAAY,CAACC,WAAD,EAAcC,MAAd,EAAsBC,QAAtB,CAA3C;AACA,WAAO;AAAE6B,kBAAF;AAAgB1B,wBAAhB;AAAoCoB,iBAApC;AAAiDC;AAAjD,KAAP;AACF;;AATa,CAAf","names":["ref","useRoute","useRouter","useStore","useCommonCartEffect","post","useMakeOrder","productList","shopId","shopName","router","store","handleConfirmOrder","iscanceled","products","i","value","product","push","id","parseInt","_id","num","count","result","addressId","errno","name","commit","e","alert","useMaskChange","showConfirm","handleShowConfirm","status","setup","route","params","calculations"],"sourceRoot":"","sources":["/Users/mac/Desktop/jingdong/src/views/orderConfirmation/Order.vue"],"sourcesContent":["<template>\n  <div class=\"order\">\n    <div class=\"order__price\">实付金额\n      <span class=\"order__price__money\">&yen;{{calculations.price}}</span>\n    </div>\n    <div class=\"order__btn\" @click='() => handleShowConfirm(true)'>提交订单</div>\n  </div>\n  <div class=\"mask\"  v-if='showConfirm' @click='() => handleShowConfirm(false)'>\n    <div class=\"mask__content\">\n      <div class=\"mask__content__title\">确认要离开收银台?</div>\n      <div class=\"mask__content__desc\">请尽快完成支付，否则将被取消</div>\n      <div class=\"mask__content__btns\">\n        <div class=\"mask__content__btn mask__content__btn--left\" @click=\"() => { handleConfirmOrder(true) }\">取消订单</div>\n        <div class=\"mask__content__btn mask__content__btn--right\" @click=\"() => { handleConfirmOrder(false) }\">确认支付</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { useCommonCartEffect } from '../../effects/cartEffects.js'\nimport { post } from '../../utils/request.js'\n\n// 订单下单逻辑\nconst useMakeOrder = (productList, shopId, shopName) => {\n  const router = useRouter()\n  const store = useStore()\n  const handleConfirmOrder = async (iscanceled) => {\n    const products = []\n    for (let i in productList.value) {\n      const product = productList.value[i]\n      products.push({ id: parseInt(product._id, 10), num: product.count })\n      // console.log(products)\n    }\n    try {\n      const result = await post('/api/order', {\n        addressId: 1,\n        shopId,\n        shopName: shopName.value,\n        iscanceled,\n        products\n      })\n      if (result?.errno === 0) {\n        router.push({ name: 'Home' })\n        store.commit('clearCart', shopId)\n      }\n    } catch (e) {\n      alert('请求失败')\n    }\n  }\n  return { handleConfirmOrder }\n}\n\n// 蒙层显示逻辑\nconst useMaskChange = () => {\n  const showConfirm = ref(false)\n  const handleShowConfirm = (status) => {\n    showConfirm.value = status\n  }\n  return { showConfirm, }\n}\nexport default {\n  name: 'Order',\n  setup () {\n    const route = useRoute()\n    const shopId = parseInt(route.params.id)\n    const { calculations, productList, shopName } = useCommonCartEffect(shopId)\n    \n    const { handleConfirmOrder } = useMakeOrder(productList, shopId, shopName)\n    return { calculations, handleConfirmOrder, showConfirm, handleShowConfirm }\n  }\n}\n</script>\n\n<style lang='scss' scoped>\n@import '../../style/viriables.scss';\n\n  // 底部\n  .order {\n    position: fixed;\n    display: flex;\n    width: 100%;\n    align-items: center;\n    justify-content: space-between;\n    padding-left: .18rem;\n    box-sizing: border-box;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height: .49rem;\n    line-height: .49rem;\n    background-color: $bgColor;\n    &__price {\n      font-size: 14px;\n      color: $content-fontcolor;\n      font-size: .14rem;\n      line-height: .20rem;\n      &__money {\n        font-size: .16rem;\n        line-height: .22rem;\n        font-weight: bold;\n      }\n    }\n    &__btn {\n      width: .98rem;\n      background-color: #4FB0F9;\n      text-align: center;\n      font-size: .14rem;\n      color: $bgColor;\n    }\n  }\n\n  .mask {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.50);\n    &__content {\n      position: absolute;\n      transform: translate(-50%, -50%);\n      top: 50%;\n      left: 50%;\n      width: 3rem;\n      height: 1.57rem;\n      background-color: #fff;\n      text-align: center;\n      border-radius: .04rem;\n      &__title {\n        margin: .24rem 0 0 0;\n        font-size: .18rem;\n        color: #333;\n      }\n      &__desc {\n        margin: .08rem 0 0 0;\n        font-size: .14rem;\n        color: #666;\n      }\n      &__btns {\n        display: flex;\n        margin: .24rem .58rem;\n      }\n      &__btn {\n        flex: 1;\n        width: .8rem;\n        line-height: .32rem;\n        border-radius: .16rem;\n        font-size: .14rem;\n        &--left {\n          margin-right: .12rem;\n          border: .01rem solid #4FB0F9;\n          color: #0091FF;\n        }\n        &--right {\n          margin-left: .12rem;\n          background: #4FB0F9;\n          color: #fff;\n          border: .01rem solid #fff;\n        }\n      }\n    }\n  }\n</style>\n"]},"metadata":{},"sourceType":"module"}